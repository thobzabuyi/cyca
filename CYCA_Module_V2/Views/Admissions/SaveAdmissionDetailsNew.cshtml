 
@model Common_Objects.ViewModels.CYCAAdmissionViewModel
@{
    ViewBag.Title = "Admission";
    
}

<div class="container" style="margin-top:3%">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <button class="btn btn-warning" id="accordion" data-parent="#accordion" href="#actionModal" onclick="showModal()"><i class="fa fa-plus"></i> New Admission</button>
                <div class="panel-heading">
                    Admission History
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="admissionList">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Select</th>
                                    <th>Case Start Date</th>
                                    <th>Case End Date</th>
                                    <th>Admission Type</th>
                                    <th>Edit</th>
                                    <th>ReAdmit</th>
                                    <th>Dropdown</th>
                                </tr>
                            </thead>
                            <tbody id="SetAdmissiontList"></tbody>

                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!--ADD NEW ADMISSION-->
<div class="modal fade" id="actionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header bg-color-brown">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">ADD/UPDATE ADMISSION DETAILS</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Admission Details
                            </div>
                            <div class="panel-body">
                                <form id="myForm">
                                    <div class="row">
                                        <div class="col-md-4">
                                            @Html.HiddenFor(m => m.PcmAssNo, new { @id = "id" })
                                            @Html.HiddenFor(m => m.Admission_Id, new { @id = "Admission_Id" })
                                            @Html.LabelFor(x => x.selectedAdmissionType)
                                        </div>
                                        <div class="col-md-8 form-group" style="">
                                            @Html.DropDownListFor(m => m.Admission_Type_Id, ViewBag.AdmissionTypeList as SelectList, "--Select--", new { @id = "Admission_Type_Id", @class = "form-control" })
                                        </div>

                                        <div class="col-md-4">
                                            @Html.LabelFor(x => x.AdmissionDate)
                                        </div>
                                        <div class="col-md-8 form-group" style="">
                                            @Html.TextBoxFor(m => m.AdmissionDate, new { @id = "casestartdate", @class = "form-control", @readonly = "readonly" })
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            @Html.LabelFor(x => x.CaseStartTime)
                                        </div>
                                        <div class="col-md-8 form-group" style="">
                                            @Html.TextBoxFor(m => m.CaseStartTime, new { @id = "casestarttime", @class = "form-control", @readonly = "readonly" })
                                        </div>


                                        <div class="col-md-4">
                                            @Html.LabelFor(x => x.selectedVenue)
                                        </div>
                                        <div class="col-md-8 form-group">
                                            @Html.DropDownListFor(m => m.VenueId, ViewBag.VenueList as SelectList, "--Select--", new { @id = "VenueId", @class = "form-control" })
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            @Html.LabelFor(x => x.CaseEndDate)
                                        </div>
                                        <div class="col-md-8 form-group">
                                            @Html.TextBoxFor(m => m.CaseEndDate, new { @id = "caseenddate", @class = "form-control" })

                                        </div>
                                        <div class="col-md-4">
                                            @Html.LabelFor(x => x.CommentsAndObservation)
                                        </div>
                                        <div class="col-md-8 form-group">
                                            @Html.TextAreaFor(m => m.CommentsAndObservation, new { @id = "comments", @class = "form-control" })
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal" id="r">Cancel</a>
                    <a href="#" class="btn btn-warning" id="Send">Send</a>
                    @*<input type="reset" value="submit" class="btn btn-success" id="btnSubmit" />*@
                </div>
            </div>
        </div>
    </div>
</div>
<!--END-->
<!--UPDATE ADMISSION DETAILS-->
<div class="modal fade" id="actionModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header bg-color-brown">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel2">ADD/UPDATE ADMISSION DETAILS</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Admission Details
                            </div>
                            <div class="panel-body">

                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.HiddenFor(m => m.Admission_Id, new { @id = "Admission_Id" })
                                        @Html.LabelFor(x => x.selectedAdmissionType)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.DropDownListFor(m => m.Admission_Type_Id, ViewBag.AdmissionTypeList as SelectList, "--Select--", new { @id = "Admission_Type_Id2", @class = "form-control" })
                                    </div>

                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.AdmissionDate)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.AdmissionDate, new { @id = "AdmissionDate", @class = "form-control", @readonly = "readonly" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.CaseStartTime)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.CaseStartTime, new { @id = "CaseStartTime", @class = "form-control", @readonly = "readonly" })
                                    </div>


                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.selectedVenue)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        @Html.DropDownListFor(m => m.VenueId, ViewBag.VenueList as SelectList, "--Select--", new { @id = "VenueId2", @class = "form-control" })

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.CaseEndDate)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        @Html.TextBoxFor(m => m.CaseEndDate, new { @id = "CaseEndDate", @class = "form-control" })

                                    </div>
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.CommentsAndObservation)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        @Html.TextAreaFor(m => m.CommentsAndObservation, new { @id = "CommentsAndObservation", @class = "form-control" })
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal" id="r">Cancel</a>
                    <a href="#" class="btn btn-warning" id="Update">Save</a>
                    @*<input type="reset" value="submit" class="btn btn-success" id="btnSubmit" />*@
                </div>
            </div>
        </div>
    </div>
</div>
<!--END-->
<!--RE-ADMISSION MODAL-->
<div class="modal fade" id="actionModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header bg-color-brown">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel3">ADD/UPDATE ADMISSION DETAILS</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Admission Details
                            </div>
                            <div class="panel-body">

                                <div class="row">
                                    <div class="col-md-3">
                                        @Html.HiddenFor(m => m.Re_Admission_Id, new { @id = "id" })
                                        @Html.HiddenFor(m => m.Admission_Id, new { @id = "Admission_Id" })
                                        @Html.LabelFor(x => x.selectedReAdmissionType)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.DropDownListFor(m => m.AdmissionType_Id, ViewBag.AdmissionTypeList as SelectList, "--Select--", new { @id = "AdmissionType_Id", @class = "form-control" })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(x => x.Re_Admission_StartDate)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.Re_Admission_StartDate, new { @id = "Re_Admission_StartDate", @class = "form-control", @readonly = "readonly" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        @Html.LabelFor(x => x.Re_Admission_CourtStartTime)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.Re_Admission_CourtStartTime, new { @id = "Re_Admission_CourtStartTime", @class = "form-control", @readonly = "readonly" })
                                    </div>


                                    <div class="col-md-3">
                                        @Html.LabelFor(x => x.selectedReAdmissionVenue)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        @Html.DropDownListFor(m => m.Venue_Id, ViewBag.VenueList as SelectList, "--Select--", new { @id = "Venue_Id", @class = "form-control" })
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        @Html.LabelFor(x => x.Re_Admission_EndDate)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        <div class="input-group">
                                            @Html.TextBoxFor(m => m.Re_Admission_EndDate, new { @id = "Re_Admission_EndDate", @class = "form-control" })
                                            <label for="Re_Admission_EndDate" class="input-group-addon btn">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(x => x.Comments)
                                    </div>
                                    <div class="col-md-8 form-group">
                                        @Html.TextAreaFor(m => m.Comments, new { @id = "Comments", @class = "form-control" })
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-default" data-dismiss="modal" id="r">Cancel</a>
                        <a href="#" class="btn btn-warning" id="ReAdmit">Save</a>
                        @*<input type="reset" value="submit" class="btn btn-success" id="btnSubmit" />*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--END-->

<script>
    //.....Get Admission.....//
    $(document).ready(function () {
        //Load Table Body
        $.getJSON('/Admissions/GetAdmissionDetailsList',
            function (json) {
                var tr;
                for (var i = 0; i < json.length; i++) {
                    tr = $('<tr/>');

                    tr.append("<td>" + json[i].Admission_Id + "</td>");
                    tr.append("<td>" + "<a href='#' class='btn btn-basic' onclick = 'SelectAdmission(" + json[i].Admission_Id + ")'><span class='glyphicon glyphicon-ok'> select</span></a>" + "</td>");
                    tr.append("<td>" + ToJavaScriptDatett(json[i].CaseStartDate) + "</td>");
                    tr.append("<td>" + ToJavaScriptDatett(json[i].CaseEndDate) + "</td>");
                    tr.append("<td>" + json[i].selectedAdmissionType + "</td>");
                    tr.append("<td>" + "<a href='#' class='btn btn-info' onclick = 'EditAdmission(" + json[i].Admission_Id + ")'><span class='glyphicon glyphicon-edit'></span> edit</a>" + "</td>");
                    tr.append("<td>" + "<a href='#' class='btn btn-info'  onclick = 'showModalReAdmission()'  ><span class='glyphicon glyphicon-plus'></span> re-admit</a>" + "</td>");
                    tr.append("<td>" + "<div id = menu <ul class = dropdown-menu><li><a>")

                    $('#SetAdmissiontList').append(tr);
                }
                $('#admissionList').DataTable(/*{ "order": [[8, "asc"]] }*/);

            });
        function ToJavaScriptDatett(value) {
            if (value == null || value == '') { 
                return 0;
            }
            else {
                var pattern = /Date\(([^)]+)\)/;
                var results = pattern.exec(value);
                var dt = new Date(parseFloat(results[1]));
                return (dt.getFullYear() + "/" + dt.getMonth()) + "/" + dt.getDate();
            }
        }

        $(document).ready(function () {

            $('.spinner').css('display', 'block');


            setTimeout(function () {
                $('.spinner').hide();
            }, 5000);

        });

   
    });
    //End...
       function SelectAdmission(Admission_Id) {
                 var url = "/CYCAAdmission/Select?AdmissionId=" + Admission_Id;
                 alert("ok...")
        $.ajax({
            type: "GET",
            url: url,
            success: function (data) {
                console.log(data);   
                console.log(data['Admission_Id']);
                alert(data);
                var admissionid = '@ViewBag.admissionid';
                alert("done...");
                
            }
        })
      

    }
    //$(document).ready(function Select() {

    //    $.ajax({
    //        type: "Get",
    //        url: "/CYCAAdmission/GetAdmissionId"           
    //    })
    //});

</script>

<script>

    //..........Add Admission .........//
    function showModal() {
        $("#actionModal").modal();
        var date = new Date();
        var dd = String(date.getDate()).padStart(2, '0');
        var mm = String(date.getMonth() + 1).padStart(2, '0');
        var yyyy = date.getFullYear();
        var hour = String(date.getHours());
        var min = String(date.getMinutes());
        $.ajax({
            success: function (data) {
                $("#casestartdate").val(yyyy + '/' + mm + '/' + dd);
                $("#casestarttime").val(hour + ':' + min);
            }, error: function () { alert('something bad happened'); }
        })
    }

    //------Save New Admission in database--------//
    $("#Send").click(function () {

        $.ajax({
            type: "Post",
            url: "/CYCAAdmission/AddNewAdmission",

            data: {
                Admission_Id: $("#id").val(),
                Admission_Type_Id: $("#Admission_Type_Id").val(),
                CaseStartDate: $("#casestartdate").val(),
                CaseStartTime: $("#casestarttime").val(),
                VenueId: $("#VenueId").val(),
                CaseEndDate: $("#caseenddate").val(),
                CommentsAndObservation: $("#comments").val()
            },
            success: function (result) {
                alert("Success!..");


                $('.spinner').css('display', 'block');


                setTimeout(function () {
                    $('.spinner').hide();
                }, 10000);

                location.reload(true);

                $("#myModal2Off").modal("hide");

            },
            error: function (xhr, ajaxOptions, error) {
                alert(xhr.status);
                alert('Error: ' + xhr.responseText);
            }
        })
    })

    //.......End.......//


    //-------Populate Admission modal------------//
    function EditAdmission(Admission_Id) {
        var url = "/CYCAAdmission/GetAdmissionByAdmissionId?AdmissionId=" + Admission_Id;
        //alert(RequestId);
        $("#myModalLabel").html("Edit Admission");
        $("#actionModal2").modal();
        $.ajax({
            type: "GET",
            url: url,
            success: function (data) {
                console.log(data);
                var obj = JSON.parse(data);
                $("#Admission_Id").val(obj.Admission_Id);
                $("#Admission_Type_Id2").val(obj.Admission_Type_Id);
                $("#AdmissionDate").val(obj.AdmissionDate);
                $("#CaseStartTime").val(obj.CaseStartTime);
                $("#VenueId2").val(obj.VenueId);
                $("#CaseEndDate").val(obj.CaseEndDate);
                $("#CommentsAndObservation").val(obj.CommentsAndObservation);

                //$("#Responsibility_Details").val(obj.Responsibility_Details);

            }, error: function () { alert('something bad happened'); }

        })

    }

    //-----End---------//


    //-------Save Edit to Database------------//
    $("#Update").click(function () {

        $.ajax({
            type: "Post",
            url: "/CYCAAdmission/UpdateAdmissionInDatabase",

            data: {

                Admission_Id: $("#Admission_Id").val(),
                Admission_Type_Id: $("#Admission_Type_Id2").val(),
                AdmissionDate: $("#AdmissionDate").val(),
                CaseStartTime: $("#CaseStartTime").val(),
                VenueId: $("#VenueId2").val(),
                CaseEndDate: $("#CaseEndDate").val(),
                CommentsAndObservation: $("#CommentsAndObservation").val()
            },
            success: function (result) {
                alert("Success!..");
                $('.spinner').css('display', 'block');
                setTimeout(function () {
                    $('.spinner').hide();
                }, 10000);

                location.reload(true);

                $("#myModal2Off").modal("hide");

            },
            error: function (xhr, ajaxOptions, error) {
                alert(xhr.status);
                alert('Error: ' + xhr.responseText);
            }
        })
    })

    //--------End-----------------------------------------------------------//





    //......Add ReAdmission Scripts....................//

    $(document).ready(function () {
        $("#Re_Admission_EndDate").datepicker();
    });
    function showModalReAdmission() {
        $("#actionModal3").modal();
        var date = new Date();
        var dd = String(date.getDate()).padStart(2, '0');
        var mm = String(date.getMonth() + 1).padStart(2, '0');
        var yyyy = date.getFullYear();
        var hour = String(date.getHours());
        var min = String(date.getMinutes());
        $.ajax({

            success: function (data) {
                $("#Re_Admission_StartDate").val(yyyy + '/' + mm + '/' + dd);
                $("#Re_Admission_CourtStartTime").val(hour + ':' + min);



            }, error: function () { alert('something bad happened'); }

        })
      
    }
    //Save New ReAdmission in database
    $("#ReAdmit").click(function () {

        $.ajax({
            type: "Post",
            url: "/CYCAAdmission/ReAdmission",

            data: {
                Re_Admission_Id: $("#id").val(),
                Admission_Id: $("#Admission_Id").val(),
                AdmissionType_Id: $("#AdmissionType_Id").val(),
                Re_Admission_StartDate: $("#Re_Admission_StartDate").val(),
                Re_Admission_CourtStartTime: $("#Re_Admission_CourtStartTime").val(),
                Venue_Id: $("#Venue_Id").val(),
                Re_Admission_EndDate: $("#Re_Admission_EndDate").val(),
                Comments: $("#Comments").val()
            },
            success: function (result) {
                alert("Success!..");
                $('.spinner').css('display', 'block');
                setTimeout(function () {
                    $('.spinner').hide();
                }, 10000);

                location.reload(true);

                $("#myModal2Off").modal("hide");

            },
            error: function (xhr, ajaxOptions, error) {
                alert(xhr.status);
                alert('Error: ' + xhr.responseText);
            }
        })
    })

    //......End............//
</script>





