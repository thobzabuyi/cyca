@model Common_Objects.ViewModels.CYCAAdmissionViewModel
@{
    ViewBag.Title = "IllegalItems";
    Layout = null;
}
@*<script src="~/Scripts/jquery-3.3.1.min.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/bootstrap.min.js"></script>*@



<div class="container" style="margin-top:3%">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <button class="btn btn-warning" id="accordion" data-parent="#accordion" href="#actionModal" onclick="AddItemModal()"><i class="fa fa-plus"></i> Add Illegal Item</button>
                <div class="panel-heading">
                    Illegal Items Found
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="illegalItemsList">
                            <thead>
                                <tr>

                                    <th>Id</th>
                                    <th>Illegal Item Description</th>
                                    <th>Illegal Item Quantity</th>
                                    <th>Staff Recieved Items</th>
                                    <th>Edit</th>

                                </tr>
                            </thead>
                            <tbody id="SetIllegalItemList"></tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@*Add New Illegal Items*@
<div class="modal fade" id="AddIllegalItem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header bg-color-brown">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel2">EDIT ILLEGAL ITEM</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Illegal item Details
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.HiddenFor(m => m.Admission_Id, new { @id = "Id" })
                                        @Html.HiddenFor(m => m.Item_Found_Id, new { @id = "Item_Found_Id" })
                                        @Html.LabelFor(x => x.Item_Description)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextAreaFor(m => m.Item_Description, new { @id = "Item_Description", @class = "form-control" })
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.Quantity)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.Quantity, new { @id = "Quantity", @class = "form-control" })
                                    </div>
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.selectedHandedBy)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @*@Html.DropDownListFor(m => m.Handed_By, ViewBag.UsersList as SelectList, "--Select--", new { @id = "Handed_By1", @class = "form-control" })*@
                                        @Html.DropDownListFor(m => m.Handed_By, new SelectList(@ViewBag.Userlist, "userId", "Full_Name"), "--Select--", new { @id = "Handed_By", @class = "form-control" })
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal" id="r">Cancel</a>
                    <a href="#" class="btn btn-warning" id="AddItem">Save</a>
                    @*<input type="reset" value="submit" class="btn btn-success" id="btnSubmit" />*@
                </div>
            </div>
        </div>
    </div>
</div>

@*Edit Illegal Items*@
<div class="modal fade" id="illegalItemModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 50%">
        <div class="modal-content">
            <div class="modal-header bg-color-brown">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel2">EDIT ILLEGAL ITEM</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Illegal item Details
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.HiddenFor(m => m.Admission_Id, new { @id = "Id" })
                                        @Html.HiddenFor(m => m.Item_Found_Id, new { @id = "Item_Found_Id" })
                                        @Html.LabelFor(x => x.Item_Description)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.Item_Description, new { @id = "Item_Description1", @class = "form-control" })
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.Quantity)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @Html.TextBoxFor(m => m.Quantity, new { @id = "Quantity1", @class = "form-control" })
                                    </div>
                                    <div class="col-md-4">
                                        @Html.LabelFor(x => x.selectedHandedBy)
                                    </div>
                                    <div class="col-md-8 form-group" style="">
                                        @*@Html.DropDownListFor(m => m.Handed_By, ViewBag.UsersList as SelectList, "--Select--", new { @id = "Handed_By1", @class = "form-control" })*@
                                        @Html.DropDownListFor(m => m.Handed_By, new SelectList(@ViewBag.Userlist, "userId", "Full_Name"), "--Select--", new { @id = "Handed_By1", @class = "form-control" })
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal" id="r">Cancel</a>
                    <a href="#" class="btn btn-warning" id="UpdateIllegalItem">Save</a>
                    @*<input type="reset" value="submit" class="btn btn-success" id="btnSubmit" />*@
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    //-----Get Bodily Search Details----------//
    $(document).ready(function () {
        //Load Table Body
        $.getJSON('../../CYCAAdmission/GetIllegalItemList',
            function (json) {
                var tr;
                for (var i = 0; i < json.length; i++) {
                    tr = $('<tr/>');

                    tr.append("<td>" + json[i].Item_Found_Id + "</td>");
                    tr.append("<td>" + json[i].Item_Description + "</td>");
                    tr.append("<td>" + json[i].Quantity + "</td>");
                    tr.append("<td>" + json[i].selectedHandedBy + "</td>");
                    tr.append("<td>" + "<a href='#' class='btn btn-info' onclick = 'EditIllegalItems(" + json[i].Item_Found_Id + ")'><span class='glyphicon glyphicon-edit'></span> edit</a>" + "</td>");

                    $('#SetIllegalItemList').append(tr);
                }
                //$('#admissionList').DataTable(/*{ "order": [[8, "asc"]] }*/);

            });

        $(document).ready(function () {

            $('.spinner').css('display', 'block');


            setTimeout(function () {
                $('.spinner').hide();
            }, 5000);

        });
    });
    //-----End------//

    //----------Add New Bodily Search-----------------//
    function AddItemModal() {
        $("#AddIllegalItem").modal();   
    }
    //------------End------------------------//

    //-----------------Edit Bodily Search---------------//
    function EditIllegalItems(Item_Found_Id) {
        var url = "/CYCAAdmission/PopulateIllegalItemModalById?IllegalItemId=" + Item_Found_Id;

        $("#myModalLabel").html("Edit Illegal Items");
        $("#illegalItemModal1").modal();
        $.ajax({
            type: "GET",
            url: url,
            success: function (data) {
                console.log(data);
                var obj = JSON.parse(data);
                $("#Item_Found_Id").val(obj.Item_Found_Id);
                $("#Item_Description1").val(obj.Item_Description);
                $("#Quantity1").val(obj.Quantity);
                $("#Handed_By1").val(obj.Handed_By);

            }, error: function () { alert('something bad happened'); }
        })
    }
    //---------------End---------------------//

    //-------Save Edit to Database------------//
    $("#UpdateIllegalItem").click(function () {

        $.ajax({
            type: "Post",
            url: "/CYCAAdmission/UpdateIllegalItemInDatabase",

            data: {

                Item_Found_Id: $("#Item_Found_Id").val(),
                Item_Description: $("#Item_Description1").val(),
                Quantity: $("#Quantity1").val(),
                Search_Reason_Id: $("#Search_Reason_Id1").val(),
                Handed_By: $("#Handed_By1").val(),
            },
            success: function (result) {
                alert("Success!..");
                $('.spinner').css('display', 'block');
                setTimeout(function () {
                    $('.spinner').hide();
                }, 10000);

                location.reload(true);

                $("#myModal2Off").modal("hide");

            },
            error: function (xhr, ajaxOptions, error) {
                alert(xhr.status);
                alert('Error: ' + xhr.responseText);
            }
        })
    })

    //--------End-----------------------------------------------------------//
</script>